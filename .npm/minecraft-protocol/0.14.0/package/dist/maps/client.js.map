{"version":3,"sources":["client.js"],"names":[],"mappings":"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","file":"client.js","sourcesContent":["var EventEmitter = require('events').EventEmitter\n  , util = require('util')\n  , debug = require('./debug')\n  , serializer = require('./transforms/serializer')\n  , compression = require('./transforms/compression')\n  , framing = require('./transforms/framing')\n  , crypto = require('crypto')\n  , states = serializer.states\n  ;\n\nvar packets = require(\"../protocol/protocol\");\nvar readPackets = require(\"./packets\").readPackets;\nvar packetIndexes = readPackets(packets, states);\n\nmodule.exports = Client;\n\nfunction Client(isServer) {\n  EventEmitter.call(this);\n\n  var socket;\n  this.packetsToParse = {};\n\n  this.serializer = serializer.createSerializer({ isServer });\n  this.compressor = null;\n  this.framer = framing.createFramer();\n  this.cipher = null;\n\n  this.decipher = null;\n  this.splitter = framing.createSplitter();\n  this.decompressor = null;\n  this.deserializer = serializer.createDeserializer({ isServer, packetsToParse: this.packetsToParse });\n\n  this._state = states.HANDSHAKING;\n  Object.defineProperty(this, \"state\", {\n    get: function() {\n      return this.serializer.protocolState;\n    },\n    set: function(newProperty) {\n      var oldProperty = this.serializer.protocolState;\n      this.serializer.protocolState = newProperty;\n      this.deserializer.protocolState = newProperty;\n      this.emit('state', newProperty, oldProperty);\n    }\n  });\n  Object.defineProperty(this, \"compressionThreshold\", {\n    get: () => this.compressor == null ? -2 : this.compressor.compressionThreshold,\n    set: (threshold) => this.setCompressionThreshold(threshold)\n  });\n\n  this.isServer = !!isServer;\n\n  this.on('newListener', function(event, listener) {\n    var direction = this.isServer ? 'toServer' : 'toClient';\n    if(packetIndexes.packetStates[direction].hasOwnProperty(event) || event === \"packet\") {\n      if(typeof this.packetsToParse[event] === \"undefined\") this.packetsToParse[event] = 1;\n      else this.packetsToParse[event] += 1;\n    }\n  });\n  this.on('removeListener', function(event, listener) {\n    var direction = this.isServer ? 'toServer' : 'toClient';\n    if(packetIndexes.packetStates[direction].hasOwnProperty(event) || event === \"packet\") {\n      this.packetsToParse[event] -= 1;\n    }\n  });\n}\n\nutil.inherits(Client, EventEmitter);\n\n// Transform weird \"packet\" types into string representing their type. Should be mostly retro-compatible\nClient.prototype.on = function(type, func) {\n  var direction = this.isServer ? 'toServer' : 'toClient';\n  if(Array.isArray(type)) {\n    arguments[0] = packetIndexes.packetNames[type[0]][direction][type[1]];\n  } else if(typeof type === \"number\") {\n    arguments[0] = packetIndexes.packetNames[this.state][direction][type];\n  }\n  EventEmitter.prototype.on.apply(this, arguments);\n};\n\nClient.prototype.onRaw = function(type, func) {\n  var arg = \"raw.\";\n  if(Array.isArray(type)) {\n    arg += packetIndexes.packetNames[type[0]][direction][type[1]];\n  } else if(typeof type === \"number\") {\n    arg += packetIndexes.packetNames[this.state][direction][type];\n  } else {\n    arg += type;\n  }\n  arguments[0] = arg;\n  EventEmitter.prototype.on.apply(this, arguments);\n};\n\nClient.prototype.setSocket = function(socket) {\n  var ended = false;\n\n  // TODO : A lot of other things needs to be done.\n  var endSocket = () => {\n    if(ended) return;\n    ended = true;\n    this.socket.removeListener('close', endSocket);\n    this.socket.removeListener('end', endSocket);\n    this.socket.removeListener('timeout', endSocket);\n    this.emit('end', this._endReason);\n  };\n\n  var onFatalError = (err) => {\n    this.emit('error', err);\n    endSocket();\n  };\n\n  var onError = (err) => this.emit('error', err);\n\n  this.socket = socket;\n\n  if(this.socket.setNoDelay)\n    this.socket.setNoDelay(true);\n\n  this.socket.on('connect', () => this.emit('connect'));\n\n  this.socket.on('error', onFatalError);\n  this.socket.on('close', endSocket);\n  this.socket.on('end', endSocket);\n  this.socket.on('timeout', endSocket);\n  this.serializer.on('error', onError);\n  this.deserializer.on('error', onError);\n  this.framer.on('error', onError);\n  this.splitter.on('error', onError);\n\n  this.socket.pipe(this.splitter).pipe(this.deserializer);\n  this.serializer.pipe(this.framer).pipe(this.socket);\n\n  this.deserializer.on('data', (parsed) => {\n    var packet = parsed.results;\n    var packetName = packetIndexes.packetNames[packet.state][this.isServer ? 'toServer' : 'toClient'][packet.id];\n    this.emit('packet', packet);\n    this.emit(packetName, packet);\n    this.emit('raw.' + packetName, parsed.buffer, packet.state);\n    this.emit('raw', parsed.buffer, packet.state);\n  });\n};\n\nClient.prototype.end = function(reason) {\n  this._endReason = reason;\n  this.socket.end();\n};\n\nClient.prototype.setEncryption = function(sharedSecret) {\n  if (this.cipher != null)\n    throw new Error(\"Set encryption twice !\");\n  this.cipher = crypto.createCipheriv('aes-128-cfb8', sharedSecret, sharedSecret);\n  this.cipher.on('error', (err) => this.emit('error', err));\n  this.framer.unpipe(this.socket);\n  this.framer.pipe(this.cipher).pipe(this.socket);\n  this.decipher = crypto.createDecipheriv('aes-128-cfb8', sharedSecret, sharedSecret);\n  this.decipher.on('error', (err) => this.emit('error', err));\n  this.socket.unpipe(this.splitter);\n  this.socket.pipe(this.decipher).pipe(this.splitter);\n}\n\nClient.prototype.setCompressionThreshold = function(threshold) {\n  if (this.compressor == null) {\n    this.compressor = compression.createCompressor(threshold);\n    this.compressor.on('error', (err) => this.emit('error', err));\n    this.serializer.unpipe(this.framer);\n    this.serializer.pipe(this.compressor).pipe(this.framer);\n    this.decompressor = compression.createDecompressor(threshold);\n    this.decompressor.on('error', (err) => this.emit('error', err));\n    this.splitter.unpipe(this.deserializer);\n    this.splitter.pipe(this.decompressor).pipe(this.deserializer);\n  } else {\n    this.decompressor.threshold = threshold;\n    this.compressor.threshold = threshold;\n  }\n}\n\nClient.prototype.write = function(packetId, params) {\n  if(Array.isArray(packetId)) {\n    if(packetId[0] !== this.state)\n      return false;\n    packetId = packetId[1];\n  }\n  if(typeof packetId === \"string\")\n    packetId = packetIndexes.packetIds[this.state][this.isServer ? \"toClient\" : \"toServer\"][packetId];\n  var packetName = packetIndexes.packetNames[this.state][this.isServer ? \"toClient\" : \"toServer\"][packetId];\n  debug(\"writing packetId \" + this.state + \".\" + packetName + \" (0x\" + packetId.toString(16) + \")\");\n  debug(params);\n  this.serializer.write({ packetId, params });\n};\n\nClient.prototype.writeRaw = function(buffer) {\n  if (this.compressor === null)\n    this.framer.write(buffer);\n  else\n    this.compressor.write(buffer);\n};\n"],"sourceRoot":"/source/"}